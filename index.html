<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mon App Arabe</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/197/197558.png">

    <style>
        :root { --bg: #f0f2f5; --text: #1c1e21; --card: #2c3e50; --success: #27ae60; }
        [data-theme="dark"] { --bg: #121212; --text: #e4e6eb; --card: #1e1e1e; }
        
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            background: var(--bg); color: var(--text); 
            display: flex; flex-direction: column; align-items: center; 
            padding: 10px; margin: 0; transition: 0.3s;
            overflow-x: hidden;
        }

        .container { width: 100%; max-width: 450px; text-align: center; }

        #recherche {
            width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #ccc;
            margin: 10px 0; font-size: 16px; box-sizing: border-box; background: white;
            color: black;
        }

        .card-container { perspective: 1000px; width: 100%; height: 320px; margin: 20px 0; }
        
        #card {
            width: 100%; height: 100%; position: relative;
            transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        #card.flipped { transform: rotateY(180deg); }

        .face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1); padding: 20px; box-sizing: border-box;
        }

        /* Face Arabe (Recto) */
        .front { background: #2c3e50; color: white !important; }

        /* Face Fran√ßaise (Verso) - On force le blanc et noir pour la visibilit√© */
        .back { 
            background: white !important; 
            color: #000000 !important; 
            transform: rotateY(180deg); 
            border: 4px solid #2c3e50; 
        }

        .arabic { 
            font-size: clamp(30px, 12vw, 70px); 
            line-height: 1.4;
            direction: rtl; 
            width: 100%;
            word-wrap: break-word;
        }

        .translation { 
            font-size: clamp(25px, 8vw, 45px); 
            font-weight: bold;
            color: #000000 !important;
            width: 100%;
            word-wrap: break-word;
        }

        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        
        button {
            padding: 15px; border: none; border-radius: 12px;
            background: #2c3e50; color: white; font-size: 18px;
            cursor: pointer;
        }
        
        button:active { transform: scale(0.95); }

        .btn-audio {
            background: var(--success); margin-top: 15px; width: 60px; height: 60px;
            border-radius: 50%; font-size: 24px; color: white; border: none;
        }

        #count { margin-top: 15px; font-weight: bold; opacity: 0.7; }

        .theme-toggle { position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 24px; z-index: 10; }

        #error-msg { color: white; background: #e74c3c; padding: 15px; border-radius: 10px; margin: 10px; display: none; }
    </style>
</head>
<body data-theme="light">

    <div class="theme-toggle" onclick="toggleTheme()">üåì</div>

    <div class="container">
        <div id="error-msg">‚ö†Ô∏è Erreur : dictionnaireGeant non trouv√© dans donnees.js !</div>
        
        <input type="text" id="recherche" placeholder="Rechercher un mot..." oninput="filtrer()">

        <div class="card-container" onclick="tourner()">
            <div id="card">
                <div class="face front">
                    <div class="arabic" id="ar">Chargement...</div>
                </div>
                <div class="face back">
                    <div class="translation" id="fr">...</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button onclick="event.stopPropagation(); change(-1)">‚¨ÖÔ∏è Pr√©c√©dent</button>
            <button onclick="event.stopPropagation(); change(1)">Suivant ‚û°Ô∏è</button>
        </div>

        <button class="btn-audio" onclick="ecouter(event)">üîä</button>

        <div id="count">0 / 0</div>
    </div>

    <script src="donnees.js"></script>

    <script>
        // Enregistrement du Service Worker (pour la Web App)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(err => console.log("Erreur SW:", err));
        }

        let index = 0;
        let liste = [];

        function charger() {
            if (typeof dictionnaireGeant !== 'undefined') {
                liste = [...dictionnaireGeant];
                MAJ();
            } else {
                document.getElementById('error-msg').style.display = 'block';
            }
        }

        function MAJ() {
            if (liste.length === 0) {
                document.getElementById('ar').textContent = "Aucun mot";
                document.getElementById('fr').textContent = "";
                document.getElementById('count').textContent = "0 / 0";
                return;
            }
            document.getElementById('card').classList.remove('flipped');
            document.getElementById('ar').textContent = liste[index].arabe;
            document.getElementById('fr').textContent = liste[index].francais;
            document.getElementById('count').textContent = (index + 1) + " / " + liste.length;
        }

        function tourner() { 
            if (liste.length > 0) {
                document.getElementById('card').classList.toggle('flipped');
            }
        }
        
        function change(dir) {
            if (liste.length === 0) return;
            index = (index + dir + liste.length) % liste.length;
            MAJ();
        }

        function filtrer() {
            const s = document.getElementById('recherche').value.toLowerCase();
            if (typeof dictionnaireGeant !== 'undefined') {
                liste = dictionnaireGeant.filter(m => 
                    m.francais.toLowerCase().includes(s) || m.arabe.includes(s)
                );
                index = 0;
                MAJ();
            }
        }

        function ecouter(e) {
            e.stopPropagation();
            if (liste.length === 0) return;
            const text = liste[index].arabe;
            const url = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(text)}&tl=ar&client=tw-ob`;
            new Audio(url).play();
        }

        function toggleTheme() {
            const b = document.body;
            const isDark = b.getAttribute('data-theme') === 'dark';
            b.setAttribute('data-theme', isDark ? 'light' : 'dark');
        }

        window.onload = charger;
    </script>
</body>
</html>
